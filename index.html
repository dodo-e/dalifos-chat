<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DalifosÂ© Chat (Beta Release)</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="style.css">
  <link rel="shortcut icon" href="logo.png" type="image/x-icon">
</head>
<body>
  <div class="navbar">
    <img src="logo.png" alt="Dalifos Logo" class="logo">
    <h1>DalifosÂ© Chat Beta</h1>
<div class="dropdown">
  <button class="dropbtn">chats</button>
  <div class="dropdown-content">
    <a href="#"title="private chat (not created)"style="cursor: not-allowed;"><img src="private-message-svgrepo-com.svg"> >private chat(not created)</a>
    <a href="#"title="private group (not created)" style="cursor: not-allowed;"><img src="group-chat-svgrepo-com.svg">private group chat(not created)</a>
    <a href="index.html"title="public chat"><img src="public-opened-svgrepo-com.svg">public chat </a>
  </div>
</div>
<br>
<br>
<br>
    <div class="dropdown">
  <button class="dropbtn">DalifosÂ© progects</button>
  <div class="dropdown-content">
    <a href="https://dodo-e.github.io/dalifos-website/" title="Dalifos main web"><img src="logo main.png">DalifosÂ© web</a>
    <a href="index.html"title="DalifosÂ© chat"><img src="public-opened-svgrepo-com.svg">DalifosÂ© chat</a>
  </div> 
</div>
     <a href="https://forms.gle/HfwsYZVLD84mia2b8" title="report errors"> <button><img src="error-svgrepo-com.svg"></button></a>
  </div>
<h2>ğŸ’¬ Dalifos Chat Beta 2</h2>
<div id="chat"></div>
<br>
<br>
<input type="file" id="avatar" accept="image/*" style="display: none;">
<button type="button" id="avatarBtn" title="Choose an avatar (optional)">
  <img src="avatar-svgrepo-com.svg" alt="choose avatar" class="avatar-icon" />
</button>
<input type="text" id="name" placeholder="Your name" title="Enter your name">
<input type="text" id="messages" placeholder="Type a message" title="Type your message here">
<button id="sendBtn"><img src="send-svgrepo-com.svg" title="Send"></button>
<br><br>
<button id="recordBtn"><img src="play-svgrepo-com.svg"></button>
<button id="stopBtn"><img src="stop-circle-svgrepo-com.svg"></button>
<h3>note:this website is beta, so if you see an error.please report it/do not share any personal data because some data may be seen by company</h3>
<h3>by devoloper of Dalifos: David</h3>
<script>
window.addEventListener("DOMContentLoaded", () => {
Â  const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
Â  if (isSafari) {
Â  Â  const warning = document.createElement("div");
Â  Â  warning.textContent = "âš ï¸ Safari is not supported. Please use Chrome, Firefox, or Edge for the best experience.";
Â  Â  warning.style.backgroundColor = "#ffcc00";
Â  Â  warning.style.color = "black";
Â  Â  warning.style.padding = "10px";
Â  Â  warning.style.borderRadius = "10px";
Â  Â  warning.style.marginBottom = "10px";
Â  Â  warning.style.fontWeight = "bold";
Â  Â  document.body.insertBefore(warning, document.body.firstChild);
Â  }

Â  if ('Notification' in window) {
Â  Â  Â  Notification.requestPermission().then(permission => {
Â  Â  Â  Â  Â  if (permission === 'granted') {
Â  Â  Â  Â  Â  Â  Â  console.log("ØªÙ… Ù…Ù†Ø­ Ø§Ù„Ø¥Ø°Ù† Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª.");
Â  Â  Â  Â  Â  } else if (permission === 'denied') {
Â  Â  Â  Â  Â  Â  Â  console.log("ØªÙ… Ø±ÙØ¶ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª.");
Â  Â  Â  Â  Â  }
Â  Â  Â  });
Â  }
Â  
Â  function showNotification(title, body) {
Â  Â  Â  if (Notification.permission === 'granted') {
Â  Â  Â  Â  Â  const notification = new Notification(title, {
Â  Â  Â  Â  Â  Â  Â  body: body,
Â  Â  Â  Â  Â  Â  Â  icon: 'https://dodo-e.github.io/dalifos-website/logo.png',
Â  Â  Â  Â  Â  Â  Â  silent: true
Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  notification.onclick = function() {
Â  Â  Â  Â  Â  Â  Â  window.focus();
Â  Â  Â  Â  Â  };
Â  Â  Â  }
Â  }
 
Â  // ------------------------------------------------------------------
Â  //  Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙˆÙ…Ø¹Ø¯Ù„Ø© Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
Â  // ------------------------------------------------------------------
  const audio = new Audio('notifacation.mp3');

  function playNotificationSound() {
      audio.currentTime = 0; // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØµÙˆØª Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
      audio.play().catch(e => console.error("Error playing sound:", e));
  }

Â  const supabaseUrl = 'https://auojqvmbgbpfkoatkvkl.supabase.co';
Â  const anonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF1b2pxdm1iZ2JwZmtvYXRrdmtsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0MzkzMzIsImV4cCI6MjA3MTAxNTMzMn0.FkqEo9BWHkBixdoQ2vEJdpZ-34l77L0Inbh62AIRFG4';
Â  const client = window.supabase.createClient(supabaseUrl, anonKey);

Â  const savedName = localStorage.getItem("chat_name");
Â  const savedAvatar = localStorage.getItem("chat_avatar");

Â  if (savedName) {
Â  Â  document.getElementById("name").value = savedName;
Â  }
Â  
Â  function displayMessage(msg) {
Â  Â  const nameInput = document.getElementById("name").value.trim() || "Anonymous";
Â  Â  const isMyMessage = msg.name === nameInput;

Â  Â  const chat = document.getElementById("chat");
Â  Â  const msgDiv = document.createElement("div");
Â  Â  msgDiv.className = isMyMessage ? "message you" : "message other";
Â  Â  
Â  Â  const nameDiv = document.createElement("div");
Â  Â  nameDiv.className = "name";
Â  Â  nameDiv.textContent = msg.name + " â€¢ " + new Date(msg.timestamp).toLocaleTimeString();
Â  Â  
Â  Â  if (msg.avatar) {
Â  Â  Â  const avatarImg = document.createElement("img");
Â  Â  Â  avatarImg.src = msg.avatar;
Â  Â  Â  avatarImg.style.width = "40px";
Â  Â  Â  avatarImg.style.height = "40px";
Â  Â  Â  avatarImg.style.borderRadius = "50%";
Â  Â  Â  avatarImg.style.marginRight = "10px";
Â  Â  Â  nameDiv.prepend(avatarImg);
Â  Â  }
Â  Â  
Â  Â  const messageDiv = document.createElement("div");
Â  Â  messageDiv.textContent = msg.message;
Â  Â  
Â  Â  msgDiv.appendChild(nameDiv);
Â  Â  msgDiv.appendChild(messageDiv);
Â  Â  chat.appendChild(msgDiv);
Â  Â  chat.scrollTop = chat.scrollHeight;
Â  }

Â  async function fetchOldMessages() {
Â  Â  try {
Â  Â  Â  const { data, error } = await client
Â  Â  Â  Â  Â  .from('messages')
Â  Â  Â  Â  Â  .select('*')
Â  Â  Â  Â  Â  .order('timestamp', { ascending: true });

Â  Â  Â  if (error) {
Â  Â  Â  Â  Â  console.error("Error fetching old messages:", error);
Â  Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  if (data) {
Â  Â  Â  Â  Â  data.forEach(msg => displayMessage(msg));
Â  Â  Â  }
Â  Â  } catch (err) {
Â  Â  Â  console.error("An unexpected error occurred while fetching messages:", err);
Â  Â  }
Â  }

Â  fetchOldMessages();

Â  const badWords = ["fuck", "asshole", "mad" , "idiot", "stupid", "dumb", "dogs", "fouls", "fool","ÙƒÙ„Ø¨", "ØºØ¨ÙŠ", "Ø£Ø­Ù…Ù‚", "Ø£Ø¨Ù„Ù‡", "Ø£Ù‡Ø¨Ù„", "Ù…Ø¬Ù†ÙˆÙ†", "Ø­Ù…Ø§Ø±", "Ø£Ø­Ù…Ù‚", "ØºØ¨ÙŠ Ø¬Ø¯Ø§", "Ø£Ø¨Ù„Ù‡ Ø¬Ø¯Ø§", "Ø£Ù‡Ø¨Ù„ Ø¬Ø¯Ø§", "Ù…Ø¬Ù†ÙˆÙ† Ø¬Ø¯Ø§", "Ø­Ù…Ø§Ø± Ø¬Ø¯Ø§", "Ø£Ù†Øª ØºØ¨ÙŠ", "Ø£Ù†Øª Ø£Ø­Ù…Ù‚", "Ø£Ù†Øª Ø£Ø¨Ù„Ù‡", "Ø£Ù†Øª Ø£Ù‡Ø¨Ù„", "Ø£Ù†Øª Ù…Ø¬Ù†ÙˆÙ†", "Ø£Ù†Øª Ø­Ù…Ø§Ø±","ğŸ¤®","ğŸ’©","ğŸ–•ğŸ¼"];
Â  const violations = JSON.parse(localStorage.getItem("violations")) || {};

Â  client
Â  Â  .channel('messages-realtime')
Â  Â  .on(
Â  Â  Â  'postgres_changes',
Â  Â  Â  {
Â  Â  Â  Â  event: 'INSERT',
Â  Â  Â  Â  schema: 'public',
Â  Â  Â  Â  table: 'messages'
Â  Â  Â  },
Â  Â  Â  (payload) => {
Â  Â  Â  Â  const msg = payload.new;
Â  Â  Â  Â  const nameInput = document.getElementById("name").value.trim() || "Anonymous";
Â  Â  Â  Â  
Â  Â  Â  Â  if (msg.name !== nameInput) {
Â  Â  Â  Â  Â  Â  displayMessage(msg);
Â  Â  Â  Â  Â  Â  showNotification("Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† " + msg.name, msg.message);
Â  Â  Â  Â  Â  Â  playNotificationSound();
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  )
Â  Â  .subscribe();

Â  let mediaRecorder;
Â  let audioChunks = [];
Â  let currentUser = "";

Â  document.getElementById("recordBtn").addEventListener("click", async () => {
Â  Â  try {
Â  Â  Â  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
Â  Â  Â  const mimeType = MediaRecorder.isTypeSupported('audio/ogg') ? 'audio/ogg' : 'audio/webm';
Â  Â  Â  mediaRecorder = new MediaRecorder(stream, { mimeType });
Â  Â  Â  audioChunks = [];

Â  Â  Â  mediaRecorder.ondataavailable = event => {
Â  Â  Â  Â  audioChunks.push(event.data);
Â  Â  Â  };

Â  Â  Â  mediaRecorder.start();
Â  Â  Â  console.log("ğŸ™ï¸ Recording started");
Â  Â  } catch (err) {
Â  Â  Â  alert("âŒ Microphone access is required to record audio.");
Â  Â  }
Â  });

Â  document.getElementById("stopBtn").addEventListener("click", () => {
Â  Â  if (!mediaRecorder || mediaRecorder.state !== "recording") {
Â  Â  Â  alert("âŒ You must start recording before stopping.");
Â  Â  Â  return;
Â  Â  }

Â  Â  mediaRecorder.stop();
Â  Â  console.log("ğŸ›‘ Recording stopped");

Â  Â  mediaRecorder.onstop = async () => {
Â  Â  Â  const mimeType = mediaRecorder.mimeType;
Â  Â  Â  const extension = mimeType.includes('ogg') ? 'ogg' : 'webm';
Â  Â  Â  const audioBlob = new Blob(audioChunks, { type: mimeType });

Â  Â  Â  if (audioBlob.size === 0) {
Â  Â  Â  Â  alert("âŒ The audio file is empty and cannot be uploaded.");
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  let fileName = `voice_${Date.now()}.${extension}`;
Â  Â  Â  fileName = fileName.replace(/[^a-zA-Z0-9_\u0600-\u06FF.]/g, '_');

Â  Â  Â  const { data: uploadData, error: uploadError } = await client.storage
Â  Â  Â  Â  .from('voice_notes')
Â  Â  Â  Â  .upload(fileName, audioBlob, {
Â  Â  Â  Â  Â  contentType: mimeType
Â  Â  Â  Â  });

Â  Â  Â  if (uploadError || !uploadData) {
Â  Â  Â  Â  alert("âŒ Upload failed. Please report this error: " + (uploadError?.message || "Unknown error"));
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const { data: publicData, error: publicUrlError } = client.storage
Â  Â  Â  Â  .from('voice_notes')
Â  Â  Â  Â  .getPublicUrl(fileName);

Â  Â  Â  if (publicUrlError || !publicData?.publicUrl) {
Â  Â  Â  Â  alert("âŒ Failed to get public URL. Please report this error.");
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const publicUrl = publicData.publicUrl;
Â  Â  Â  const nameInput = document.getElementById("name").value.trim();
Â  Â  Â  currentUser = nameInput || "Anonymous";

Â  Â  Â  const { error: dbError } = await client
Â  Â  Â  Â  .from('voice_messages')
Â  Â  Â  Â  .insert([
Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  name: currentUser,
Â  Â  Â  Â  Â  Â  audio_url: publicUrl,
Â  Â  Â  Â  Â  Â  timestamp: new Date().toISOString()
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  ]);

Â  Â  Â  if (dbError) {
Â  Â  Â  Â  alert("âŒ Failed to save message. Please report this error: " + dbError.message);
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const chat = document.getElementById("chat");
Â  Â  Â  const msgDiv = document.createElement("div");
Â  Â  Â  msgDiv.className = "message you";

Â  Â  Â  const nameDiv = document.createElement("div");
Â  Â  Â  nameDiv.className = "name";
Â  Â  Â  nameDiv.textContent = currentUser + " â€¢ " + new Date().toLocaleTimeString();

Â  Â  Â  const audioPlayer = document.createElement("audio");
Â  Â  Â  audioPlayer.controls = true;
Â  Â  Â  audioPlayer.style.width = "100%";

Â  Â  Â  const source = document.createElement("source");
Â  Â  Â  source.src = publicUrl;
Â  Â  Â  source.type = mimeType;

Â  Â  Â  audioPlayer.appendChild(source);
Â  Â  Â  audioPlayer.innerHTML += "Your browser does not support audio playback.";

Â  Â  Â  msgDiv.appendChild(nameDiv);
Â  Â  Â  msgDiv.appendChild(audioPlayer);
Â  Â  Â  chat.appendChild(msgDiv);
Â  Â  Â  chat.scrollTop = chat.scrollHeight;
Â  Â  };
Â  });

Â  document.getElementById("avatarBtn").addEventListener("click", () => {
Â  Â  document.getElementById("avatar").click();
Â  });

Â  document.getElementById("sendBtn").addEventListener("click", async () => {
Â  Â  const nameInput = document.getElementById("name").value.trim();
Â  Â  const messageInput = document.getElementById("messages").value.trim();
Â  Â  const avatarFile = document.getElementById("avatar").files[0];

Â  Â  if (!messageInput) {
Â  Â  Â  alert("âŒ you must enter a message before sending.");
Â  Â  Â  return;
Â  Â  }

Â  Â  const name = nameInput || "Anonymous";
Â  Â  const lowerMessage = messageInput.toLowerCase();
Â  Â  const containsBadWord = badWords.some(word => lowerMessage.includes(word));
Â  Â  const userViolations = violations[name] || { count: 0, bannedUntil: null };
Â  Â  const now = Date.now();

Â  Â  if (userViolations.bannedUntil && now < userViolations.bannedUntil) {
Â  Â  Â  alert("âŒ you are currently banned from sending messages. Please wait 5 minutes until the ban expires.");
Â  Â  Â  return;
Â  Â  }

Â  Â  if (containsBadWord) {
Â  Â  Â  userViolations.count += 1;

Â  Â  Â  if (userViolations.count === 1) {
Â  Â  Â  Â  alert("âš ï¸ inappropriate language detected. This is your first warning.after 3 warnings, you will be banned for 5 minutes.");
Â  Â  Â  } else if (userViolations.count >= 3) {
Â  Â  Â  Â  userViolations.bannedUntil = now + 5 * 60 * 1000;
Â  Â  Â  Â  alert("ğŸš« you are banned from using massaging for 5 minutes because of using inappropriate words a lot");
Â  Â  Â  Â  await client
Â  Â  Â  Â  Â  .from('messages')
Â  Â  Â  Â  Â  .insert([
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  name: "ğŸš¨ system",
Â  Â  Â  Â  Â  Â  Â  message: `${name} is banned for using inappropriate language.`,
Â  Â  Â  Â  Â  Â  Â  avatar: "",
Â  Â  Â  Â  Â  Â  Â  timestamp: new Date().toISOString()
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  ]);
Â  Â  Â  Â  violations[name] = userViolations;
Â  Â  Â  Â  localStorage.setItem("violations", JSON.stringify(violations));
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  violations[name] = userViolations;
Â  Â  Â  localStorage.setItem("violations", JSON.stringify(violations));
Â  Â  }

Â  Â  let avatarUrl = "";

Â  Â  if (avatarFile) {
Â  Â  Â  const avatarFileName = `avatar_${Date.now()}_${avatarFile.name}`.replace(/[^a-zA-Z0-9_.]/g, '_');

Â  Â  Â  const { data: uploadData, error: uploadError } = await client.storage
Â  Â  Â  Â  .from('avatars')
Â  Â  Â  Â  .upload(avatarFileName, avatarFile, {
Â  Â  Â  Â  Â  contentType: avatarFile.type
Â  Â  Â  Â  });

Â  Â  Â  if (uploadError) {
Â  Â  Â  Â  alert("âŒ error uploading avatar.report this error: " + uploadError.message);
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const { data: publicData } = client.storage
Â  Â  Â  Â  .from('avatars')
Â  Â  Â  Â  .getPublicUrl(avatarFileName);

Â  Â  Â  avatarUrl = publicData.publicUrl;
Â  Â  }

Â  Â  const { error: dbError } = await client
Â  Â  Â  .from('messages')
Â  Â  Â  .insert([
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  name: name,
Â  Â  Â  Â  Â  message: messageInput,
Â  Â  Â  Â  Â  avatar: avatarUrl,
Â  Â  Â  Â  Â  timestamp: new Date().toISOString()
Â  Â  Â  Â  }
Â  Â  Â  ]);

Â  Â  if (dbError) {
Â  Â  Â  alert("âŒ error saving massege.report this problem " + dbError.message);
Â  Â  Â  return;
Â  Â  }

Â  Â  localStorage.setItem("chat_name", name);
Â  Â  localStorage.setItem("chat_avatar", avatarUrl);

Â  Â  const chat = document.getElementById("chat");
Â  Â  const msgDiv = document.createElement("div");
Â  Â  msgDiv.className = "message you";

Â  Â  const nameDiv = document.createElement("div");
Â  Â  nameDiv.className = "name";
Â  Â  nameDiv.textContent = name + " â€¢ " + new Date().toLocaleTimeString();

Â  Â  if (avatarUrl) {
Â  Â  Â  const avatarImg = document.createElement("img");
Â  Â  Â  avatarImg.src = avatarUrl;
Â  Â  Â  avatarImg.style.width = "50px";
Â  Â  Â  avatarImg.style.height = "50px";
Â  Â  Â  avatarImg.style.borderRadius = "100%";
Â  Â  Â  avatarImg.style.marginRight = "10px";
Â  Â  Â  nameDiv.prepend(avatarImg);
Â  Â  }

Â  Â  const messageDiv = document.createElement("div");
Â  Â  messageDiv.textContent = messageInput;

Â  Â  msgDiv.appendChild(nameDiv);
Â  Â  msgDiv.appendChild(messageDiv);
Â  Â  chat.appendChild(msgDiv);
Â  Â  chat.scrollTop = chat.scrollHeight;

Â  Â  document.getElementById("messages").value = "";
Â  Â  document.getElementById("avatar").value = "";
Â  });
});
</script>
</body>
</html>